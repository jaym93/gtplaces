--- php-5.3.0/ext/standard/mail.c.orig	2008-10-03 15:59:33.000000000 +0200
+++ php-5.3.0/ext/standard/mail.c	2009-02-24 16:55:09.309701040 +0200
@@ -46,6 +46,10 @@
 #include "win32/sendmail.h"
 #endif
 
+#if HAVE_ZMAIL
+#include "ext/zmail/php_zmail.h"
+#endif
+
 #ifdef NETWARE
 #define EX_OK           0       /* successful termination */
 #define EX_TEMPFAIL     75      /* temp failure; user is invited to retry */
@@ -201,6 +205,10 @@
 #if (defined PHP_WIN32 || defined NETWARE)
 	int tsm_err;
 	char *tsm_errmsg = NULL;
+#else
+    #if defined (HAVE_ZMAIL)
+         char *zsm_errmsg = NULL;
+    #endif
 #endif
 	FILE *sendmail;
 	int ret;
@@ -210,6 +218,19 @@
 	void (*sig_handler)() = NULL;
 #endif
 
+#ifdef AIX_PASE
+    #ifdef HAVE_ZMAIL
+            if(ZSendMail(to, subject, message, headers, &zsm_errmsg) == FAILURE) {
+                    php_error_docref(NULL TSRMLS_CC, E_WARNING, "%s", zsm_errmsg);
+                    efree(zsm_errmsg);
+                    MAIL_RET(0);
+            } else {
+                    MAIL_RET(1);
+            }
+    #else
+            MAIL_RET(0);
+    #endif
+#else
 	if (!sendmail_path) {
 #if (defined PHP_WIN32 || defined NETWARE)
 		/* handle old style win smtp sending */
@@ -224,9 +245,20 @@
 		}
 		MAIL_RET(1);
 #else
+	#if defined (HAVE_ZMAIL)
+		if(ZSendMail(to, subject, message, headers, &zsm_errmsg) == FAILURE) {
+			php_error_docref(NULL TSRMLS_CC, E_WARNING, "%s", zsm_errmsg);
+			efree(zsm_errmsg);
+			MAIL_RET(0);
+		} else {
+			MAIL_RET(1);
+		}
+	#else
 		MAIL_RET(0);
+	#endif
 #endif
 	}
+#endif
 	if (extra_cmd != NULL) {
 		spprintf(&sendmail_cmd, 0, "%s %s", sendmail_path, extra_cmd);
 	} else {

