--- php-5.2.8/ext/gd/libgd/gd.c.orig	2008/07/31 09:22:17	1.90.2.1.2.23
+++ php-5.2.8/ext/gd/libgd/gd.c		2008/12/10 13:33:10	1.90.2.1.2.24
@@ -3136,7 +3136,7 @@
 		return NULL;
 	}
 
-	if (!gdImageTrueColor(src) && clrBack>=gdImageColorsTotal(src)) {
+	if (!gdImageTrueColor(src) && (clrBack < 0 || clrBack>=gdImageColorsTotal(src))) {
 		return NULL;
 	}
